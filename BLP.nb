(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     72347,       1567]
NotebookOptionsPosition[     67632,       1494]
NotebookOutlinePosition[     68014,       1510]
CellTagsIndexPosition[     67971,       1507]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"fakevar", "=", "0"}], ";", " ", 
  RowBox[{"Remove", "[", "\"\<Global`*\>\"", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.84351641321834*^9, 3.8435164386223927`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"01b5a031-f324-463f-a91f-8f1c20b2db72"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SetDirectory", "[", "\"\<C:/Users/Nathan/Downloads/BLP\>\"", 
  "]"}]], "Input",
 CellChangeTimes->{{3.843511915149012*^9, 3.843511929786974*^9}},
 CellLabel->"In[2]:=",ExpressionUUID->"f818eec8-44c0-47ca-9a3b-b95d2307afd2"],

Cell[BoxData["\<\"C:\\\\Users\\\\Nathan\\\\Downloads\\\\BLP\"\>"], "Output",
 CellChangeTimes->{{3.843511930526623*^9, 3.843511959171337*^9}, 
   3.8435164478849154`*^9, 3.8435172271585336`*^9, 3.84351771044746*^9, 
   3.8435191833455973`*^9, 3.8435228726892815`*^9},
 CellLabel->"Out[2]=",ExpressionUUID->"14d03ecb-96a5-4c76-8b97-e1331b42e16d"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Directory", "[", "]"}]], "Input",
 CellChangeTimes->{{3.8433959820532637`*^9, 3.843396020056589*^9}, {
  3.8435107346898985`*^9, 3.843510744623843*^9}},
 CellLabel->"In[3]:=",ExpressionUUID->"98aa87ea-4ace-42c9-9a21-bd79434f1326"],

Cell[BoxData["\<\"C:\\\\Users\\\\Nathan\\\\Downloads\\\\BLP\"\>"], "Output",
 CellChangeTimes->{
  3.8433960209650965`*^9, 3.8433964800191565`*^9, 3.8433975616808863`*^9, 
   3.84339770585093*^9, 3.843398008916914*^9, {3.8433981922733326`*^9, 
   3.843398209717727*^9}, 3.843398292573716*^9, 3.8433983275216956`*^9, 
   3.8433983896003513`*^9, 3.843405998688301*^9, 3.843407231451991*^9, 
   3.843407312275861*^9, {3.843407342649681*^9, 3.843407357023141*^9}, 
   3.8434202018721437`*^9, 3.843422797567068*^9, {3.8434229356885796`*^9, 
   3.8434229558420773`*^9}, 3.843422996592976*^9, 3.843423086318493*^9, {
   3.8434231389491844`*^9, 3.843423155235279*^9}, 3.8434241155111885`*^9, 
   3.8434243165257144`*^9, 3.8434244615012546`*^9, 3.843424638088567*^9, 
   3.8434266774990096`*^9, 3.8434270378183603`*^9, 3.84342885730455*^9, 
   3.843428983831955*^9, 3.843430218624638*^9, 3.8434307585864553`*^9, 
   3.8434326386102657`*^9, 3.843432674799996*^9, 3.8434327261444855`*^9, 
   3.8434353600027304`*^9, 3.843435403509329*^9, 3.843435503685124*^9, 
   3.843483102753113*^9, 3.843489391751028*^9, 3.8434905192833366`*^9, 
   3.8434906833027053`*^9, 3.8434912647074685`*^9, 3.8434921579746037`*^9, 
   3.843493204363042*^9, 3.843496994318204*^9, 3.8434988284175043`*^9, 
   3.8435006430854816`*^9, 3.843503219741276*^9, 3.8435035421782036`*^9, 
   3.843503680675585*^9, 3.843503958345049*^9, 3.8435062892212086`*^9, 
   3.843509761403073*^9, 3.843509801908512*^9, 3.84350986046638*^9, 
   3.843509985473443*^9, 3.8435101993672185`*^9, 3.8435102996244264`*^9, 
   3.8435107451115904`*^9, 3.8435119014366817`*^9, 3.8435119593837185`*^9, 
   3.8435164480569267`*^9, 3.843517227354395*^9, 3.843517710574092*^9, 
   3.8435191835268087`*^9, 3.8435228728762827`*^9},
 CellLabel->"Out[3]=",ExpressionUUID->"f707864a-ee69-4fff-976c-8e48b6182948"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"ProductData", " ", "=", " ", 
   RowBox[{"Import", "[", 
    RowBox[{"\"\<nevo_products.csv\>\"", ",", "\"\<Dataset\>\"", ",", 
     RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"nObs", "=", 
  RowBox[{
   RowBox[{"Dimensions", "[", "ProductData", "]"}], "[", 
   RowBox[{"[", "1", "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.843395968200467*^9, 3.843395973047367*^9}, {
   3.843396035924498*^9, 3.8433960388415194`*^9}, {3.843396397293571*^9, 
   3.843396400285076*^9}, 3.843398201791432*^9, {3.843398358466317*^9, 
   3.843398373167813*^9}, {3.843406071342127*^9, 3.84340609387899*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"82f625e1-3e70-4fb3-93c1-57f6b074918c"],

Cell[BoxData["2256"], "Output",
 CellChangeTimes->{
  3.8434060945870275`*^9, 3.8434072317745085`*^9, 3.843407312561861*^9, {
   3.8434073429336815`*^9, 3.8434073572891383`*^9}, 3.8434202021380205`*^9, 
   3.843422798237648*^9, {3.8434229359235783`*^9, 3.8434229561380777`*^9}, 
   3.843422996851976*^9, 3.8434230866154947`*^9, {3.8434231392021856`*^9, 
   3.8434231555662823`*^9}, 3.8434241157595744`*^9, 3.84342432060026*^9, 
   3.8434244624183702`*^9, 3.8434246389877987`*^9, 3.8434266778090076`*^9, 
   3.843427038129364*^9, 3.8434288575665493`*^9, 3.8434289845406437`*^9, 
   3.843430218866639*^9, 3.843430758826976*^9, 3.8434326388532653`*^9, 
   3.8434326750559945`*^9, 3.843432726491486*^9, 3.8434353604953012`*^9, 
   3.8434354039808426`*^9, 3.8434355041231227`*^9, 3.8434831030016985`*^9, 
   3.8434893920040236`*^9, 3.8434905195449066`*^9, 3.843490683899765*^9, 
   3.8434912651499586`*^9, 3.843492158253604*^9, 3.8434932046228724`*^9, 
   3.8434969945695577`*^9, 3.8434988286797066`*^9, 3.8435006435024824`*^9, 
   3.843503220052389*^9, 3.843503542452688*^9, 3.8435036812191734`*^9, 
   3.843503959080914*^9, 3.8435062895131063`*^9, 3.843509761727311*^9, 
   3.843509802168707*^9, 3.84350986136738*^9, 3.843509985742443*^9, 
   3.843510200175022*^9, 3.8435102999249873`*^9, 3.8435119017426863`*^9, 
   3.8435119601647186`*^9, 3.843516448312215*^9, 3.8435172277800407`*^9, 
   3.8435177108242245`*^9, 3.8435191837648697`*^9, 3.8435228736142797`*^9},
 CellLabel->"Out[5]=",ExpressionUUID->"0fe9a3a5-30fd-4d45-b953-397c80249f88"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"agentData", "=", 
   RowBox[{"Import", "[", 
    RowBox[{"\"\<nevo_agents.csv\>\"", ",", "\"\<Dataset\>\"", ",", 
     RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.8434276630246563`*^9, 3.843427681115302*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"b08353a9-2c5c-428d-bbee-69c211a9eeef"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"productIDs", " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"ProductData", "[", 
     RowBox[{"All", ",", "\"\<product_ids\>\""}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"uniqueProducts", " ", "=", " ", 
   RowBox[{"DeleteDuplicates", "[", "productIDs", "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"out", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{"Function", "[", 
      RowBox[{
       RowBox[{"{", "prod", "}"}], ",", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DiscreteIndicator", "[", 
           RowBox[{"#", ",", "prod", ",", "uniqueProducts"}], "]"}], "&"}], 
         ",", "productIDs"}], "]"}]}], "]"}], ",", "uniqueProducts"}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"dummies", " ", "=", " ", 
   RowBox[{"Dataset", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"AssociationThread", "[", 
       RowBox[{"uniqueProducts", "\[Rule]", "#"}], "]"}], "&"}], "/@", 
     RowBox[{"Transpose", "[", "out", "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.843395968200467*^9, 3.843395973047367*^9}, {
   3.843396035924498*^9, 3.8433960388415194`*^9}, {3.843396397293571*^9, 
   3.843396400285076*^9}, 3.843398201791432*^9, {3.843398358466317*^9, 
   3.843398373167813*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"07715fe0-7e58-4bb4-abd1-929fa00e9433"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ProductData", "=", 
    RowBox[{"Join", "[", 
     RowBox[{"ProductData", ",", 
      RowBox[{"ProductData", "[", 
       RowBox[{"All", ",", 
        RowBox[{
         RowBox[{"<|", 
          RowBox[{"\"\<const\>\"", "\[Rule]", "1"}], "|>"}], "&"}]}], "]"}], 
      ",", "2"}], "]"}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"adding", " ", "a", " ", "column"}], " ", "=", " ", 
    RowBox[{
    "1", " ", "called", " ", "const", " ", "for", " ", "the", " ", 
     "regressions"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ProductDataWithDummies", " ", "=", " ", 
   RowBox[{"Dataset", "@", 
    RowBox[{"Join", "[", 
     RowBox[{
      RowBox[{"Normal", "[", "ProductData", "]"}], ",", " ", 
      RowBox[{"Normal", "[", "dummies", "]"}], ",", "2"}], "]"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.8433975532497387`*^9, 3.843397554236289*^9}, {
   3.843398130582463*^9, 3.8433981791447954`*^9}, {3.8433982694518676`*^9, 
   3.84339829121572*^9}, {3.843398384824378*^9, 3.843398387993066*^9}, 
   3.8434059598224955`*^9, {3.843491059487585*^9, 3.843491061113288*^9}, {
   3.843491238237133*^9, 3.843491279865113*^9}, 3.843492162405484*^9},
 CellLabel->"In[11]:=",ExpressionUUID->"61a7d0c2-239b-4942-92e3-dbf74f25df2a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Zs", " ", "=", " ", 
   RowBox[{
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"\"\<demand_instruments\>\"", " ", "<>", " ", 
        RowBox[{"ToString", "[", "#", "]"}]}], " ", "&"}], ",", 
      RowBox[{"Range", "[", 
       RowBox[{"0", ",", "19"}], "]"}]}], "]"}], " ", "~", "Join", "~", 
    "uniqueProducts"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Zmat", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Normal", "[", 
        RowBox[{"ProductDataWithDummies", "[", 
         RowBox[{"All", ",", "#"}], "]"}], "]"}], "&"}], ",", "Zs"}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Xs", "=", " ", 
   RowBox[{
    RowBox[{"{", "\"\<prices\>\"", "}"}], " ", "~", "Join", "~", 
    "uniqueProducts"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Xmat", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Normal", "[", 
        RowBox[{"ProductDataWithDummies", "[", 
         RowBox[{"All", ",", "#"}], "]"}], "]"}], "&"}], ",", "Xs"}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X2s", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<const\>\"", ",", "\"\<prices\>\"", ",", "\"\<sugar\>\"", ",", 
     "\"\<mushy\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X2mat", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Normal", "[", 
        RowBox[{"ProductDataWithDummies", "[", 
         RowBox[{"All", ",", "#"}], "]"}], "]"}], "&"}], ",", "X2s"}], "]"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8434040399449453`*^9, 3.843404041457549*^9}, {
   3.8434040904251013`*^9, 3.8434041502798862`*^9}, {3.84340429135351*^9, 
   3.843404659441923*^9}, {3.843404755566119*^9, 3.843404761646827*^9}, {
   3.84340480360958*^9, 3.843404866354461*^9}, 3.8434049040498962`*^9, {
   3.8434070185065074`*^9, 3.8434070696291337`*^9}, {3.843430127888914*^9, 
   3.843430201108451*^9}, {3.843430245821634*^9, 3.8434302593245296`*^9}, {
   3.8434302914171047`*^9, 3.8434303399290357`*^9}, {3.8434304079734707`*^9, 
   3.84343044762493*^9}, {3.8434911250769835`*^9, 3.8434911371363354`*^9}},
 CellLabel->"In[13]:=",ExpressionUUID->"66453435-852a-46cd-8d9f-d1c0f8d5a9e6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"demographicVarnames", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<income\>\"", ",", "\"\<income_squared\>\"", ",", "\"\<age\>\"", ",", 
     "\"\<child\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"nodeVarnames", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"\"\<nodes\>\"", " ", "<>", " ", 
       RowBox[{"ToString", "[", "#", "]"}]}], " ", "&"}], ",", 
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", "3"}], "]"}]}], "]"}]}], " ", ";"}]}], "Input",
 CellChangeTimes->{{3.8434305833511734`*^9, 3.84343063445891*^9}, {
  3.843430668842881*^9, 3.843430753384573*^9}, {3.8434307860876045`*^9, 
  3.8434308851673546`*^9}, {3.8434311456040783`*^9, 3.843431177746188*^9}, {
  3.8434313620330067`*^9, 3.84343137239509*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"d2f933b5-6528-446e-b104-f0d7390d6524"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"getAgentDataCol", "[", 
   RowBox[{"colName_", ",", "market_"}], "]"}], ":=", 
  RowBox[{"Normal", "[", 
   RowBox[{"agentData", "[", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", "\"\<market_ids\>\"", "]"}], "\[Equal]", "market"}],
        "&"}], "]"}], ",", "colName"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getProductDataCol", "[", 
   RowBox[{"colName_", ",", "market_"}], "]"}], ":=", 
  RowBox[{"Normal", "[", 
   RowBox[{"ProductDataWithDummies", "[", 
    RowBox[{
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", "\"\<market_ids\>\"", "]"}], "\[Equal]", "market"}],
        "&"}], "]"}], ",", "colName"}], "]"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.8434305833511734`*^9, 3.84343063445891*^9}, {
   3.843430668842881*^9, 3.843430753384573*^9}, {3.8434307860876045`*^9, 
   3.8434308851673546`*^9}, {3.8434311456040783`*^9, 3.843431177746188*^9}, {
   3.8434313620330067`*^9, 3.84343137239509*^9}, {3.843431415842575*^9, 
   3.843431434168309*^9}, {3.8434314849502563`*^9, 3.8434315193145523`*^9}, {
   3.843431733995284*^9, 3.843431909376791*^9}, 3.8434319959616814`*^9, {
   3.843432096409048*^9, 3.8434320987791214`*^9}, {3.843432494224971*^9, 
   3.843432511818637*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"c2fbbae8-fc9b-4506-99bd-7448bce921ff"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"goodSigma", "=", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"{", 
     RowBox[{"0.3757", ",", "1.834", ",", 
      RowBox[{"-", "0.00337"}], ",", "0.07911"}], "}"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"goodPi", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"3.10280677", ",", "0", ",", "1.16453374", ",", "0"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"16.84614669", ",", 
       RowBox[{"-", "0.67578163"}], ",", "0", ",", "11.52934335"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.19290232"}], ",", "0", ",", "0.02994053", ",", "0"}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"1.45683942", ",", "0", ",", 
       RowBox[{"-", "1.49335238"}], ",", "0"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initialSigma", "=", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"{", 
     RowBox[{"0.3302", ",", "2.4526", ",", "0.0163", ",", "0.2441"}], "}"}], 
    "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"initialPi", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"5.4819", ",", "0", ",", "0.2037", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"15.8935", ",", 
       RowBox[{"-", "1.2000"}], ",", "0", ",", "2.6342"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", "0.2506"}], ",", "0", ",", "0.0511", ",", "0"}], "}"}], 
     ",", 
     RowBox[{"{", 
      RowBox[{"1.2650", ",", "0", ",", 
       RowBox[{"-", "0.8091"}], ",", "0"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sigma", " ", "=", " ", "initialSigma"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pi", "=", "initialPi"}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8434305833511734`*^9, 3.84343063445891*^9}, {
  3.843430668842881*^9, 3.843430753384573*^9}, {3.8434307860876045`*^9, 
  3.8434308851673546`*^9}, {3.8434311456040783`*^9, 3.8434311803766403`*^9}, {
  3.8434314550870256`*^9, 3.8434314561671176`*^9}, {3.8434315310313005`*^9, 
  3.8434315772072334`*^9}, {3.843431641961573*^9, 3.8434317323432026`*^9}, {
  3.8434319270075912`*^9, 3.8434319941484456`*^9}, {3.843432075663725*^9, 
  3.843432106306893*^9}, {3.84343515105577*^9, 3.8434352200373783`*^9}, {
  3.843435350002928*^9, 3.843435402106308*^9}, {3.8434354865667276`*^9, 
  3.8434355019063025`*^9}, {3.8435036709635983`*^9, 3.8435036795281677`*^9}, {
  3.8435039145292473`*^9, 3.8435039541377115`*^9}, {3.843509790535305*^9, 
  3.8435098004782143`*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"40f5b28d-e45d-4266-96cd-e6ca5f3b01e6"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"marketIDs", " ", "=", " ", 
   RowBox[{"Normal", "[", 
    RowBox[{"ProductData", "[", 
     RowBox[{"All", ",", "\"\<market_ids\>\""}], "]"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"uniqueMarkets", " ", "=", " ", 
   RowBox[{"DeleteDuplicates", "[", "marketIDs", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.843420265705239*^9, 3.843420267535219*^9}, {
   3.843420306107837*^9, 3.8434203581489353`*^9}, {3.8434203942593217`*^9, 
   3.8434204410616407`*^9}, {3.843420484154147*^9, 3.843420489387288*^9}, {
   3.843420531553376*^9, 3.843420705538079*^9}, {3.8434207453536787`*^9, 
   3.8434208105974436`*^9}, {3.8434209173616686`*^9, 
   3.8434209697768426`*^9}, {3.843421062182583*^9, 3.8434210816183567`*^9}, {
   3.8434212934963617`*^9, 3.843421319095917*^9}, {3.843421367844651*^9, 
   3.843421377255739*^9}, {3.843421435083637*^9, 3.843421453029046*^9}, {
   3.843421503778906*^9, 3.8434215099905605`*^9}, {3.843421575013198*^9, 
   3.843421575407713*^9}, {3.843422216686863*^9, 3.8434224231587305`*^9}, {
   3.843422457942462*^9, 3.8434224637774143`*^9}, {3.843422588522383*^9, 
   3.8434225907976894`*^9}, {3.8434227183516903`*^9, 
   3.8434227776383543`*^9}, {3.8434229235819874`*^9, 3.843422931267623*^9}, {
   3.8434237494146833`*^9, 3.843423834026105*^9}, {3.8434238792502656`*^9, 
   3.8434240131279993`*^9}, {3.8434240530762587`*^9, 
   3.8434241140829363`*^9}, {3.8434243757801147`*^9, 3.843424377980665*^9}, 
   3.843424634107378*^9, {3.8434247080833282`*^9, 3.843424710577957*^9}, 
   3.8434324448089743`*^9, {3.843432780404858*^9, 3.8434328072096586`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"495b46db-df76-4193-84b4-9dcaaca8e5db"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "scales", " ", "down", " ", "the", " ", "utilities", " ", 
    "so", " ", "that", " ", "the", " ", "utility", " ", "of", " ", "the", " ",
     "first", " ", "preference", " ", "is", " ", "never", " ", 
    RowBox[{"Exp", "[", 
     RowBox[{"a", " ", "large", " ", "positive", " ", "number"}], "]"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"getProbabilitiesSafely", "[", "utility_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"scalingReduction", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{"Max", "[", "#", "]"}], ",", "0"}], "]"}], "&"}], ",", 
         "utility"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"outsideUtility", "=", 
       RowBox[{"Exp", "[", 
        RowBox[{"-", "scalingReduction"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"scaledUtility", "=", 
       RowBox[{"utility", "-", "scalingReduction"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"exponentiatedScaledUtilities", "=", 
       RowBox[{"Exp", "[", "scaledUtility", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"probabilities", "=", 
       RowBox[{"exponentiatedScaledUtilities", "/", 
        RowBox[{"(", 
         RowBox[{"outsideUtility", "+", 
          RowBox[{"Map", "[", 
           RowBox[{"Total", ",", "exponentiatedScaledUtilities"}], "]"}]}], 
         ")"}]}]}], ";", "\[IndentingNewLine]", "probabilities"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 CellChangeTimes->{{3.843503258479946*^9, 3.843503259769249*^9}, {
  3.843503330424368*^9, 3.843503360589654*^9}, {3.843503424528514*^9, 
  3.843503426551475*^9}, {3.843503474106683*^9, 3.843503474300997*^9}, {
  3.8435172590615435`*^9, 3.843517302108101*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"030b796c-7929-4269-84a8-d1064ef36fb5"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"allTheRCs", " ", "=", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\"\<const\>\"", ",", "\"\<nodes0\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<prices\>\"", ",", "\"\<nodes1\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<sugar\>\"", ",", "\"\<nodes2\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<mushy\>\"", ",", "\"\<nodes3\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<const\>\"", ",", "\"\<income\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<const\>\"", ",", "\"\<age\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<prices\>\"", ",", "\"\<income\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<prices\>\"", ",", "\"\<income_squared\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<prices\>\"", ",", "\"\<child\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<sugar\>\"", ",", "\"\<income\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<sugar\>\"", ",", "\"\<age\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<mushy\>\"", ",", "\"\<income\>\""}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<mushy\>\"", ",", "\"\<age\>\""}], "}"}]}], "}"}]}], ";", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "these", " ", "are", " ", "the", " ", "nonzero", " ", "entries", " ", 
      "in", " ", "Pi", " ", "and", " ", "Sigma"}], ",", " ", 
     RowBox[{
     "I", " ", "should", " ", "probably", " ", "get", " ", "them", " ", 
      "that", " ", "way", " ", "instead", " ", "of", " ", "listing", " ", 
      "them"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"broadcastAdd", "[", 
     RowBox[{"arr1_", ",", "arr2_"}], "]"}], ":=", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Outer", "[", 
       RowBox[{"Plus", ",", "arr1", ",", "arr2"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"2", ",", "4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "3"}], "}"}]}], "}"}]}], "]"}]}]}], " ", 
  RowBox[{"(*", 
   RowBox[{"adds", " ", "on", " ", "a", " ", "cartesian", " ", "grid"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getTangent", "[", 
   RowBox[{"market_", ",", "probabilities_", ",", "weights_", ",", "RCdef_"}],
    "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"productVar", ",", "agentVar"}], "}"}], "=", "RCdef"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"productCharacteristic", "=", 
      RowBox[{"getProductDataCol", "[", 
       RowBox[{"productVar", ",", "market"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"agentCharacteristic", "=", 
      RowBox[{"getAgentDataCol", "[", 
       RowBox[{"agentVar", ",", "market"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tangent", " ", "=", " ", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"probabilities", " ", "*", " ", "agentCharacteristic"}], 
        ")"}], " ", "*", " ", 
       RowBox[{"broadcastAdd", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", "productCharacteristic", "}"}], "\[Transpose]"}], ",", 
         RowBox[{"-", 
          RowBox[{
           RowBox[{"{", "productCharacteristic", "}"}], ".", 
           RowBox[{"probabilities", "\[Transpose]"}]}]}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"weights", ".", "tangent"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getSEstuff", "[", 
   RowBox[{"delta_", ",", "market_", ",", "mu_", ",", "trueShares_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"probabilities", "=", 
      RowBox[{"getProbabilitiesSafely", "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"mu", "+", "delta"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"weights", "=", 
      RowBox[{"getAgentDataCol", "[", 
       RowBox[{"\"\<weights\>\"", ",", "market"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"impliedShares", " ", "=", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{"weights", ",", "probabilities"}], "]"}]}], ";", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"diagonalShares", " ", "=", " ", 
      RowBox[{"DiagonalMatrix", "[", "impliedShares", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"weightedProbabilities", "=", 
      RowBox[{"probabilities", "*", "weights"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sharesByXiJac", "=", 
      RowBox[{"diagonalShares", "-", 
       RowBox[{
        RowBox[{"probabilities", "\[Transpose]"}], ".", 
        "weightedProbabilities"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sharesByThetaJac", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getTangent", "[", 
          RowBox[{"market", ",", "probabilities", ",", "weights", ",", "#"}], 
          "]"}], "&"}], ",", "allTheRCs"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xiByThetaJac", " ", "=", " ", 
      RowBox[{"LinearSolve", "[", 
       RowBox[{"sharesByXiJac", ",", 
        RowBox[{"sharesByThetaJac", "\[Transpose]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "xiByThetaJac"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8434818983431206`*^9, 3.843481900288844*^9}, {
   3.843482001004488*^9, 3.8434820391570663`*^9}, 3.8434824036586905`*^9, {
   3.8434824444058166`*^9, 3.8434824910393353`*^9}, {3.843482845841611*^9, 
   3.843482877285453*^9}, {3.843482932208047*^9, 3.843482982611599*^9}, {
   3.8434831954509397`*^9, 3.8434832246108036`*^9}, {3.8434892589964805`*^9, 
   3.843489259347875*^9}, {3.843489294495456*^9, 3.843489306559883*^9}, {
   3.843489360598073*^9, 3.8434893886823683`*^9}, {3.8434894560078573`*^9, 
   3.8434895863974123`*^9}, {3.8434900608866653`*^9, 
   3.8434904506910887`*^9}, {3.8434904834574924`*^9, 
   3.8434904940088134`*^9}, {3.8434905468029175`*^9, 3.843490563926363*^9}, 
   3.843490666689186*^9, {3.8434913579594383`*^9, 3.8434913861598473`*^9}, {
   3.84349151776246*^9, 3.8434915480166025`*^9}, {3.8434916071633825`*^9, 
   3.8434916353353853`*^9}, {3.8434918888635406`*^9, 
   3.8434919155421276`*^9}, {3.8434919947425284`*^9, 3.843491995281494*^9}, {
   3.8434921159793077`*^9, 3.84349214749273*^9}, {3.84349317624243*^9, 
   3.843493188210662*^9}, {3.843493359384975*^9, 3.8434933989843435`*^9}, {
   3.843493448888075*^9, 3.8434934789229918`*^9}, {3.843493541836855*^9, 
   3.843493580653797*^9}, {3.8434971416233635`*^9, 3.8434971564602175`*^9}, {
   3.843503097903389*^9, 3.8435030981281166`*^9}, {3.8435032127144337`*^9, 
   3.8435032360305624`*^9}, {3.843503285621356*^9, 3.843503309564737*^9}, {
   3.8435034123993006`*^9, 3.8435034194868417`*^9}, {3.8435034529360447`*^9, 
   3.843503470251565*^9}, {3.8435035074654627`*^9, 3.8435035214517393`*^9}, {
   3.8435162174397335`*^9, 3.843516217845462*^9}, {3.843516472488655*^9, 
   3.843516505281377*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"1e60aaac-47bf-43c8-aa1d-deb82410b124"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"oneIteration", "[", 
   RowBox[{"delta_", ",", "market_", ",", "mu_", ",", "trueShares_"}], "]"}], 
  " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"probabilities", "=", 
      RowBox[{"getProbabilitiesSafely", "[", 
       RowBox[{"Transpose", "[", 
        RowBox[{"mu", "+", "delta"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"weights", "=", 
      RowBox[{"getAgentDataCol", "[", 
       RowBox[{"\"\<weights\>\"", ",", "market"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"impliedShares", " ", "=", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{"weights", ",", "probabilities"}], "]"}]}], ";", " ", 
     "\[IndentingNewLine]", 
     RowBox[{"updatedDelta", "=", 
      RowBox[{"delta", "+", 
       RowBox[{"Log", "[", "trueShares", "]"}], "-", 
       RowBox[{"Log", "[", "impliedShares", "]"}]}]}], ";", 
     "\[IndentingNewLine]", "updatedDelta"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"maxIter", "=", "5000"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"absTol", "=", 
   SuperscriptBox["10", 
    RowBox[{"-", "12"}]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fixedPointInit", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"Length", "[", 
      RowBox[{"ProductData", "[", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", "\"\<market_ids\>\"", "]"}], "\[Equal]", 
          RowBox[{"uniqueMarkets", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "&"}], "]"}], "]"}], "]"}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"oldDeltas", " ", "=", " ", "fixedPointInit"}], ";"}]}], "Input",
 CellChangeTimes->{{3.843420265705239*^9, 3.843420267535219*^9}, {
   3.843420306107837*^9, 3.8434203581489353`*^9}, {3.8434203942593217`*^9, 
   3.8434204410616407`*^9}, {3.843420484154147*^9, 3.843420489387288*^9}, {
   3.843420531553376*^9, 3.843420705538079*^9}, {3.8434207453536787`*^9, 
   3.8434208105974436`*^9}, {3.8434209173616686`*^9, 
   3.8434209697768426`*^9}, {3.843421062182583*^9, 3.8434210816183567`*^9}, {
   3.8434212934963617`*^9, 3.843421319095917*^9}, {3.843421367844651*^9, 
   3.843421377255739*^9}, {3.843421435083637*^9, 3.843421453029046*^9}, {
   3.843421503778906*^9, 3.8434215099905605`*^9}, {3.843421575013198*^9, 
   3.843421575407713*^9}, {3.843422216686863*^9, 3.8434224231587305`*^9}, {
   3.843422457942462*^9, 3.8434224637774143`*^9}, {3.843422588522383*^9, 
   3.8434225907976894`*^9}, {3.8434227183516903`*^9, 
   3.8434227776383543`*^9}, {3.843422970965989*^9, 3.8434230203170757`*^9}, {
   3.843423053006983*^9, 3.843423081875849*^9}, {3.8434231275734086`*^9, 
   3.8434231748839397`*^9}, {3.84342327135077*^9, 3.8434233144522133`*^9}, {
   3.84342360849656*^9, 3.843423665746388*^9}, {3.8434241006636662`*^9, 
   3.843424169705368*^9}, {3.843424358865122*^9, 3.8434243667153625`*^9}, {
   3.8434244003252654`*^9, 3.8434244161028023`*^9}, 3.8434244931429596`*^9, {
   3.843424540523537*^9, 3.843424540848383*^9}, {3.8434245989248214`*^9, 
   3.843424606699477*^9}, {3.843424664603936*^9, 3.8434246953221345`*^9}, {
   3.843424742458198*^9, 3.8434247510492797`*^9}, {3.843425143836321*^9, 
   3.8434251669981565`*^9}, {3.843426416878393*^9, 3.8434265464521875`*^9}, {
   3.843426643749153*^9, 3.8434266756885386`*^9}, {3.843426710108423*^9, 
   3.843426719100326*^9}, {3.8434268013156095`*^9, 3.843426878690282*^9}, {
   3.8434269854497533`*^9, 3.8434270363839865`*^9}, {3.8434288333876143`*^9, 
   3.843428855801749*^9}, {3.8434288978068542`*^9, 3.843428963337202*^9}, {
   3.8434321676779423`*^9, 3.8434322485951586`*^9}, {3.843432297267126*^9, 
   3.8434323158055105`*^9}, 3.8434323638178024`*^9, 3.843432410960001*^9, {
   3.843432452208552*^9, 3.843432472650511*^9}, {3.8434325268113256`*^9, 
   3.8434325473463306`*^9}, {3.843432590724601*^9, 3.843432594241439*^9}, {
   3.8434326627273364`*^9, 3.8434326696108027`*^9}, {3.8434327118241553`*^9, 
   3.843432724463996*^9}, {3.843434579327941*^9, 3.8434346102547474`*^9}, {
   3.8434818295300965`*^9, 3.8434818507670155`*^9}, {3.843482776301563*^9, 
   3.843482803830974*^9}, {3.843503027467622*^9, 3.843503091998522*^9}, 
   3.84350353013183*^9, {3.8435097073593454`*^9, 3.843509708250257*^9}, {
   3.8435098418339157`*^9, 3.843509844916299*^9}, {3.843509978478963*^9, 
   3.8435099842458086`*^9}, {3.843510137195591*^9, 3.8435101416857133`*^9}, {
   3.8435102084030724`*^9, 3.8435102365035467`*^9}, {3.8435102822135515`*^9, 
   3.8435102922407227`*^9}, {3.8435169614890003`*^9, 
   3.8435169617269692`*^9}, {3.843517003737789*^9, 3.8435170208035975`*^9}, 
   3.84352284999061*^9},
 CellLabel->"In[35]:=",ExpressionUUID->"8d0c1960-48f1-4b94-bad7-be435913df86"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getYVals", "[", 
   RowBox[{"market_", ",", "sigma_", ",", "pi_", ",", 
    RowBox[{"getJacobianForStandardErrors_:", "False"}]}], "]"}], " ", ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"nProducts", ",", "mu", ",", "trueShares"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"nProducts", "=", 
      RowBox[{"Length", "[", 
       RowBox[{"ProductData", "[", 
        RowBox[{"Select", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "[", "\"\<market_ids\>\"", "]"}], "\[Equal]", 
           "market"}], "&"}], "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"demographics", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getAgentDataCol", "[", 
          RowBox[{"#", ",", "market"}], "]"}], "&"}], ",", 
        "demographicVarnames"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"nodes", "=", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getAgentDataCol", "[", 
          RowBox[{"#", ",", "market"}], "]"}], "&"}], ",", "nodeVarnames"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"coefficients", " ", "=", 
      RowBox[{
       RowBox[{"Dot", "[", 
        RowBox[{"sigma", ",", "nodes"}], "]"}], "+", 
       RowBox[{"Dot", "[", 
        RowBox[{"pi", ",", "demographics"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"X2mat", "=", 
      RowBox[{"Transpose", "[", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"getProductDataCol", "[", 
           RowBox[{"#", ",", "market"}], "]"}], "&"}], ",", "X2s"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"mu", "=", 
      RowBox[{"Dot", "[", 
       RowBox[{"X2mat", ",", "coefficients"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"trueShares", " ", "=", " ", 
      RowBox[{"getProductDataCol", "[", 
       RowBox[{"\"\<shares\>\"", ",", "market"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"oldDeltas", "=", 
      RowBox[{"Take", "[", 
       RowBox[{
        RowBox[{"PadRight", "[", 
         RowBox[{"oldDeltas", ",", "nProducts"}], "]"}], ",", "nProducts"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "this", " ", "uses", " ", "the", " ", "deltas", " ", "from", " ", "the",
        " ", "last", " ", "market", " ", "for", " ", "a", " ", "warm", " ", 
       "start"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"yVals", "=", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"newDeltas", "=", 
          RowBox[{"oneIteration", "[", 
           RowBox[{"oldDeltas", ",", "market", ",", "mu", ",", "trueShares"}],
            "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Norm", "[", 
             RowBox[{
              RowBox[{"newDeltas", "-", "oldDeltas"}], ",", "\[Infinity]"}], 
             "]"}], "<", "absTol"}], ",", 
           RowBox[{
            RowBox[{"Return", "[", "newDeltas", "]"}], ";", 
            RowBox[{"Break", "[", "]"}]}], ",", 
           RowBox[{"oldDeltas", "=", "newDeltas"}]}], "]"}], ";", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"iterCount", "\[Equal]", "maxIter"}], ",", 
           RowBox[{
            RowBox[{
            "Print", "[", "\"\<Iteration failed to converge\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"iterCount", ",", "maxIter"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"xiByThetaJac", "=", 
      RowBox[{"If", "[", 
       RowBox[{"getJacobianForStandardErrors", ",", 
        RowBox[{"getSEstuff", "[", 
         RowBox[{"yVals", ",", "market", ",", "mu", ",", "trueShares"}], 
         "]"}], ",", 
        RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"yVals", ",", "xiByThetaJac"}], "}"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.843420265705239*^9, 3.843420267535219*^9}, {
   3.843420306107837*^9, 3.8434203581489353`*^9}, {3.8434203942593217`*^9, 
   3.8434204410616407`*^9}, {3.843420484154147*^9, 3.843420489387288*^9}, {
   3.843420531553376*^9, 3.843420705538079*^9}, {3.8434207453536787`*^9, 
   3.8434208105974436`*^9}, {3.8434209173616686`*^9, 
   3.8434209697768426`*^9}, {3.843421062182583*^9, 3.8434210816183567`*^9}, {
   3.8434212934963617`*^9, 3.843421319095917*^9}, {3.843421367844651*^9, 
   3.843421377255739*^9}, {3.843421435083637*^9, 3.843421453029046*^9}, {
   3.843421503778906*^9, 3.8434215099905605`*^9}, {3.843421575013198*^9, 
   3.843421575407713*^9}, {3.843422216686863*^9, 3.8434224231587305`*^9}, {
   3.843422457942462*^9, 3.8434224637774143`*^9}, {3.843422588522383*^9, 
   3.8434225907976894`*^9}, {3.8434227183516903`*^9, 
   3.8434227776383543`*^9}, {3.843422970965989*^9, 3.8434230203170757`*^9}, {
   3.843423053006983*^9, 3.843423081875849*^9}, {3.8434231275734086`*^9, 
   3.8434231748839397`*^9}, {3.84342327135077*^9, 3.8434233144522133`*^9}, {
   3.84342360849656*^9, 3.843423665746388*^9}, {3.8434241006636662`*^9, 
   3.843424169705368*^9}, {3.843424358865122*^9, 3.8434243667153625`*^9}, {
   3.8434244003252654`*^9, 3.8434244161028023`*^9}, 3.8434244931429596`*^9, {
   3.843424540523537*^9, 3.843424540848383*^9}, {3.8434245989248214`*^9, 
   3.843424606699477*^9}, {3.843424664603936*^9, 3.8434246953221345`*^9}, {
   3.843424742458198*^9, 3.8434247510492797`*^9}, {3.843425143836321*^9, 
   3.8434251669981565`*^9}, {3.843426416878393*^9, 3.8434265464521875`*^9}, {
   3.843426643749153*^9, 3.8434266756885386`*^9}, {3.843426710108423*^9, 
   3.843426719100326*^9}, {3.8434268013156095`*^9, 3.843426878690282*^9}, {
   3.8434269854497533`*^9, 3.8434270363839865`*^9}, {3.8434288333876143`*^9, 
   3.843428855801749*^9}, {3.8434288978068542`*^9, 3.843428963337202*^9}, {
   3.8434321676779423`*^9, 3.8434322485951586`*^9}, {3.843432297267126*^9, 
   3.8434323158055105`*^9}, 3.8434323638178024`*^9, 3.843432410960001*^9, {
   3.843432452208552*^9, 3.843432472650511*^9}, {3.8434325268113256`*^9, 
   3.8434325473463306`*^9}, {3.843432590724601*^9, 3.843432594241439*^9}, {
   3.8434326627273364`*^9, 3.8434326696108027`*^9}, {3.8434327118241553`*^9, 
   3.843432724463996*^9}, {3.843434579327941*^9, 3.8434345881284804`*^9}, {
   3.8434353831410637`*^9, 3.8434353854276495`*^9}, {3.8434818035517035`*^9, 
   3.8434818195660987`*^9}, {3.8434819687856107`*^9, 
   3.8434819885690203`*^9}, {3.84348303450377*^9, 3.8434830803628426`*^9}, 
   3.843483153236733*^9, {3.843483373796915*^9, 3.843483389339491*^9}, 
   3.8434911934440117`*^9, 3.8434916668207636`*^9, {3.843494939893324*^9, 
   3.8434949582724066`*^9}, {3.8434988409836264`*^9, 3.843498848268408*^9}, {
   3.8435089692129498`*^9, 3.843509006789872*^9}, {3.8435090608568377`*^9, 
   3.843509132105624*^9}, {3.843509198797259*^9, 3.84350924416319*^9}, {
   3.8435095225300465`*^9, 3.8435095533071656`*^9}, {3.8435096531892953`*^9, 
   3.8435097151303387`*^9}, {3.8435099561250563`*^9, 
   3.8435099707266283`*^9}, {3.8435101839879456`*^9, 
   3.8435101915190883`*^9}, {3.843510272270045*^9, 3.843510272565641*^9}, {
   3.8435114443868275`*^9, 3.8435114473582015`*^9}, 3.8435115371141405`*^9, {
   3.8435115784817915`*^9, 3.8435116401678286`*^9}, {3.843516960047814*^9, 
   3.8435169640953517`*^9}, {3.843517164407814*^9, 3.84351721903524*^9}},
 CellLabel->"In[40]:=",ExpressionUUID->"e4f601af-98c3-4a2b-acb5-6aeb7a178eba"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8434971780615788`*^9, 3.843497335118902*^9}, {
   3.843497373953844*^9, 3.8434974193010798`*^9}, {3.8434974495421844`*^9, 
   3.84349745128308*^9}, {3.843497536297993*^9, 3.8434975628357964`*^9}, {
   3.8434976050839777`*^9, 3.843497785371006*^9}, {3.843497845560727*^9, 
   3.8434978576863966`*^9}, {3.8434979043463697`*^9, 
   3.8434979107029257`*^9}, {3.8434979623986998`*^9, 
   3.8434979899771585`*^9}, {3.8434980216397076`*^9, 3.843498042870885*^9}, {
   3.8434983440567293`*^9, 3.843498449058456*^9}, {3.843498496682927*^9, 
   3.8434985136827717`*^9}, {3.8434987451049557`*^9, 3.8434987498810062`*^9}, 
   3.843516353758406*^9},
 CellLabel->"In[41]:=",ExpressionUUID->"7b7c5488-f6dd-4483-9970-59c154722d41"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"marketOutput", " ", "=", " ", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"getYVals", "[", 
       RowBox[{"#", ",", "sigma", ",", "pi", ",", "True"}], "]"}], "&"}], ",",
      "uniqueMarkets"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"yVals", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"marketOutput", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1", ",", "All"}], "]"}], "]"}], ",", "1"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"xiByThetaJacVals", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"marketOutput", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "2", ",", "All"}], "]"}], "]"}], ",", "1"}], 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.843420265705239*^9, 3.843420267535219*^9}, {
   3.843420306107837*^9, 3.8434203581489353`*^9}, {3.8434203942593217`*^9, 
   3.8434204410616407`*^9}, {3.843420484154147*^9, 3.843420489387288*^9}, {
   3.843420531553376*^9, 3.843420705538079*^9}, {3.8434207453536787`*^9, 
   3.8434208105974436`*^9}, {3.8434209173616686`*^9, 
   3.8434209697768426`*^9}, {3.843421062182583*^9, 3.8434210816183567`*^9}, {
   3.8434212934963617`*^9, 3.843421319095917*^9}, {3.843421367844651*^9, 
   3.843421377255739*^9}, {3.843421435083637*^9, 3.843421453029046*^9}, {
   3.843421503778906*^9, 3.8434215099905605`*^9}, {3.843421575013198*^9, 
   3.843421575407713*^9}, {3.843422216686863*^9, 3.8434224231587305`*^9}, {
   3.843422457942462*^9, 3.8434224637774143`*^9}, {3.843422588522383*^9, 
   3.8434225907976894`*^9}, {3.8434227183516903`*^9, 
   3.8434227776383543`*^9}, {3.843422970965989*^9, 3.8434230203170757`*^9}, {
   3.843423053006983*^9, 3.843423081875849*^9}, {3.8434231275734086`*^9, 
   3.8434231748839397`*^9}, {3.84342327135077*^9, 3.8434233144522133`*^9}, {
   3.84342360849656*^9, 3.843423665746388*^9}, {3.8434241006636662`*^9, 
   3.843424169705368*^9}, {3.843424358865122*^9, 3.8434243667153625`*^9}, {
   3.8434244003252654`*^9, 3.8434244161028023`*^9}, 3.8434244931429596`*^9, {
   3.843424540523537*^9, 3.843424540848383*^9}, {3.8434245989248214`*^9, 
   3.843424606699477*^9}, {3.843424664603936*^9, 3.8434246953221345`*^9}, {
   3.843424742458198*^9, 3.8434247510492797`*^9}, {3.843425143836321*^9, 
   3.8434251669981565`*^9}, {3.843426416878393*^9, 3.8434265464521875`*^9}, {
   3.843426643749153*^9, 3.8434266756885386`*^9}, {3.843426710108423*^9, 
   3.843426719100326*^9}, {3.8434268013156095`*^9, 3.843426878690282*^9}, {
   3.8434269854497533`*^9, 3.8434270363839865`*^9}, {3.8434288333876143`*^9, 
   3.843428855801749*^9}, {3.8434288978068542`*^9, 3.843428963337202*^9}, {
   3.8434321676779423`*^9, 3.8434322485951586`*^9}, {3.843432297267126*^9, 
   3.8434323158055105`*^9}, 3.8434323638178024`*^9, 3.843432410960001*^9, {
   3.843432452208552*^9, 3.843432472650511*^9}, {3.8434325268113256`*^9, 
   3.8434325473463306`*^9}, {3.843432590724601*^9, 3.843432594241439*^9}, {
   3.8434326627273364`*^9, 3.8434326696108027`*^9}, {3.8434327118241553`*^9, 
   3.843432724463996*^9}, {3.843434579327941*^9, 3.8434345881284804`*^9}, 
   3.843435136544645*^9, {3.8434831848773413`*^9, 3.8434831878242593`*^9}, {
   3.8434948830461664`*^9, 3.8434949338660088`*^9}, {3.843494992769912*^9, 
   3.8434949928234444`*^9}, {3.843497006365267*^9, 3.843497013697118*^9}, {
   3.8434970840969296`*^9, 3.8434970855586195`*^9}, {3.84349870172734*^9, 
   3.843498754379202*^9}, {3.8434988125116453`*^9, 3.8434988153070297`*^9}, {
   3.843511459373477*^9, 3.8435114684359407`*^9}, {3.8435116253371925`*^9, 
   3.8435116263590164`*^9}, 3.843511868485004*^9, 3.8435119749645414`*^9},
 CellLabel->"In[42]:=",ExpressionUUID->"c708a4b4-f71a-499d-8263-00ffc100d517"],

Cell[BoxData[
 RowBox[{
  RowBox[{"weightMat", " ", "=", " ", 
   RowBox[{"Inverse", "[", 
    RowBox[{
     RowBox[{"Dot", "[", 
      RowBox[{
       RowBox[{"Zmat", "\[Transpose]"}], ",", "Zmat"}], "]"}], "/", "nObs"}], 
    "]"}]}], ";"}]], "Input",
 CellLabel->"In[45]:=",ExpressionUUID->"ae3265cd-6c79-48fb-bc95-5f3ad333849b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"parameters", "=", 
   RowBox[{"Dot", "[", 
    RowBox[{
     RowBox[{"Inverse", "[", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"Xmat", "\[Transpose]"}], ",", "Zmat", ",", "weightMat", ",", 
        RowBox[{"Zmat", "\[Transpose]"}], ",", "Xmat"}], "]"}], "]"}], ",", 
     RowBox[{"Xmat", "\[Transpose]"}], ",", "Zmat", ",", "weightMat", ",", 
     RowBox[{"Zmat", "\[Transpose]"}], ",", "yVals"}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"residuals", "=", 
   RowBox[{"yVals", "-", 
    RowBox[{"Dot", "[", 
     RowBox[{"Xmat", ",", "parameters"}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8434070771892214`*^9, 3.8434072289687557`*^9}, {
  3.8434073534525423`*^9, 3.843407355457533*^9}, {3.8434241774554367`*^9, 
  3.8434241781014028`*^9}, {3.8434343959211006`*^9, 3.843434417879321*^9}, {
  3.843498897516578*^9, 3.8434988995428996`*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"512641dc-f6f5-4515-8259-cb720382e2df"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"multipliedElementWise", " ", "=", " ", 
   RowBox[{"residuals", " ", "*", " ", "Zmat"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"meang", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"Mean", "[", "multipliedElementWise", "]"}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.843405168292577*^9, 3.84340520824409*^9}, {
   3.843405329313725*^9, 3.843405341674247*^9}, {3.843405544113836*^9, 
   3.8434055489509*^9}, {3.8434056325923557`*^9, 3.8434056378659487`*^9}, {
   3.8434057019273148`*^9, 3.8434057034369*^9}, {3.8434058126242857`*^9, 
   3.8434058142090006`*^9}, {3.8434073376577835`*^9, 
   3.8434073388059006`*^9}, {3.843476954287943*^9, 3.843476954628572*^9}, {
   3.8434996287423344`*^9, 3.8434996291932034`*^9}, 3.8435097451177225`*^9},
 CellLabel->"In[48]:=",ExpressionUUID->"cc8fcd6f-426c-483d-a6da-bbbd9bb21af5"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"objective", " ", "=", " ", 
  RowBox[{"Dot", "[", 
   RowBox[{"meang", ",", "weightMat", ",", 
    RowBox[{"meang", "\[Transpose]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"scaledObjective", " ", "=", " ", 
  RowBox[{"objective", " ", "nObs"}]}]}], "Input",
 CellChangeTimes->{{3.8434056953307114`*^9, 3.843405866615511*^9}, {
  3.8434059849098577`*^9, 3.8434060661432495`*^9}, {3.843406098148243*^9, 
  3.8434061039926014`*^9}, {3.8434061705886235`*^9, 3.8434061713028946`*^9}, {
  3.843406276213275*^9, 3.8434062774001646`*^9}, {3.843476957223769*^9, 
  3.843476960801883*^9}},
 CellLabel->"In[50]:=",ExpressionUUID->"62aac27a-bb17-49ee-9748-912bf21a1d98"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", "0.013011233655180901`", "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.8434057688568764`*^9, 3.8434058672530327`*^9}, {
   3.8434060007689743`*^9, 3.8434060371529565`*^9}, 3.843406108439463*^9, 
   3.843407234417202*^9, 3.843407314882229*^9, {3.843407344916946*^9, 
   3.8434073588303895`*^9}, 3.8434202032320204`*^9, 3.8434227999255114`*^9, {
   3.8434229374046316`*^9, 3.843422957598503*^9}, 3.8434229996345077`*^9, 
   3.843423088077813*^9, {3.8434231407712717`*^9, 3.843423157157457*^9}, 
   3.8434292695805073`*^9, 3.8434327331993794`*^9, 3.8434353706145353`*^9, 
   3.843435427164455*^9, 3.843435514283307*^9, 3.843483124353566*^9, 
   3.8434989055705233`*^9, 3.8434996339499917`*^9, 3.8435006967265415`*^9, 
   3.843503585810753*^9, 3.8435040483348646`*^9, 3.8435097721272306`*^9, 
   3.8435098125846696`*^9, 3.8435103348230133`*^9, 3.843516493404048*^9, 
   3.843517280292278*^9, 3.8435177573041863`*^9, 3.843519240399952*^9, 
   3.843522908556254*^9},
 CellLabel->"Out[50]=",ExpressionUUID->"d29ce53c-5870-472c-a1aa-4655a75881e0"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", "29.353343126088113`", "}"}], "}"}]], "Output",
 CellChangeTimes->{{3.8434057688568764`*^9, 3.8434058672530327`*^9}, {
   3.8434060007689743`*^9, 3.8434060371529565`*^9}, 3.843406108439463*^9, 
   3.843407234417202*^9, 3.843407314882229*^9, {3.843407344916946*^9, 
   3.8434073588303895`*^9}, 3.8434202032320204`*^9, 3.8434227999255114`*^9, {
   3.8434229374046316`*^9, 3.843422957598503*^9}, 3.8434229996345077`*^9, 
   3.843423088077813*^9, {3.8434231407712717`*^9, 3.843423157157457*^9}, 
   3.8434292695805073`*^9, 3.8434327331993794`*^9, 3.8434353706145353`*^9, 
   3.843435427164455*^9, 3.843435514283307*^9, 3.843483124353566*^9, 
   3.8434989055705233`*^9, 3.8434996339499917`*^9, 3.8435006967265415`*^9, 
   3.843503585810753*^9, 3.8435040483348646`*^9, 3.8435097721272306`*^9, 
   3.8435098125846696`*^9, 3.8435103348230133`*^9, 3.843516493404048*^9, 
   3.843517280292278*^9, 3.8435177573041863`*^9, 3.843519240399952*^9, 
   3.843522908586256*^9},
 CellLabel->"Out[51]=",ExpressionUUID->"480d37ed-7336-4413-826e-2c693f899a87"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{
    RowBox[{"multipliedElementWise", "\[Transpose]"}], ".", 
    "multipliedElementWise"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8434998324190063`*^9, 3.8434998357716813`*^9}, {
  3.843509757701743*^9, 3.843509757907213*^9}},
 CellLabel->"In[52]:=",ExpressionUUID->"0d870bb7-33d7-43fc-8799-8d2cda37ed08"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"d", " ", "=", 
   RowBox[{"Rest", "[", "parameters", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"X", " ", "=", " ", 
   RowBox[{"Transpose", "[", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"getProductDataCol", "[", 
        RowBox[{"#", ",", 
         RowBox[{"uniqueMarkets", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "&"}], ",", 
      RowBox[{"{", 
       RowBox[{"\"\<const\>\"", ",", "\"\<sugar\>\"", ",", "\"\<mushy\>\""}], 
       "}"}]}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"combinedJac", "=", 
   RowBox[{"Join", "[", 
    RowBox[{"xiByThetaJacVals", ",", 
     RowBox[{"-", "Xmat"}], ",", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GMMMomentsJacMean", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"Zmat", "\[Transpose]"}], ".", "combinedJac"}], "/", "nObs"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"covariancesInverse", "=", 
   RowBox[{
    RowBox[{"GMMMomentsJacMean", "\[Transpose]"}], ".", "weightMat", ".", 
    "GMMMomentsJacMean"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"covariances", "=", 
   RowBox[{"Inverse", "[", "covariancesInverse", "]"}]}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.8434369507460485`*^9, 3.843436967592417*^9}, {
   3.8434370634197245`*^9, 3.8434370987300644`*^9}, {3.8434371753759146`*^9, 
   3.843437178236335*^9}, {3.843437431512949*^9, 3.8434374377967176`*^9}, {
   3.8434911752488127`*^9, 3.8434911817311497`*^9}, {3.843495012321067*^9, 
   3.843495020105313*^9}, {3.8434951012854233`*^9, 3.843495140761204*^9}, {
   3.8434952009106555`*^9, 3.843495364308118*^9}, {3.843495424219787*^9, 
   3.843495446631608*^9}, {3.843499644590537*^9, 3.843499647252673*^9}, {
   3.843499692496628*^9, 3.8434996947990823`*^9}, {3.843499791702317*^9, 
   3.8434998655092115`*^9}, {3.8435000163737307`*^9, 3.843500016564731*^9}, {
   3.843500047346859*^9, 3.843500098263956*^9}, {3.8435001514053936`*^9, 
   3.8435002308647084`*^9}, 3.843500411417823*^9, {3.8435005772696004`*^9, 
   3.843500603562081*^9}, 3.8435118517986107`*^9},
 CellLabel->"In[53]:=",ExpressionUUID->"f578568c-ff0c-4e3d-b323-a8f320a43cbf"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"S", " ", "=", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"multipliedElementWise", "\[Transpose]"}], ".", 
     "multipliedElementWise"}], "/", "nObs"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"S", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"S", "+", 
      RowBox[{"S", "\[Transpose]"}]}], ")"}], "/", "2"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"robustCovariances", "=", 
   RowBox[{"covariances", ".", 
    RowBox[{"GMMMomentsJacMean", "\[Transpose]"}], ".", "weightMat", ".", "S",
     ".", "weightMat", ".", "GMMMomentsJacMean", ".", "covariances"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"robustCovariances", " ", "=", " ", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"robustCovariances", "+", 
      RowBox[{"robustCovariances", "\[Transpose]"}]}], " ", ")"}], "/", 
    "2"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"W", " ", "=", " ", 
   RowBox[{"Inverse", "[", 
    RowBox[{"robustCovariances", "[", 
     RowBox[{"[", 
      RowBox[{
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Length", "[", "d", "]"}]}], ";;", 
        RowBox[{"-", "1"}]}], ",", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Length", "[", "d", "]"}]}], ";;", 
        RowBox[{"-", "1"}]}]}], "]"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"beta", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"First", "@", "parameters"}], "}"}], "~", "Join", "~", 
    RowBox[{"LinearSolve", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"X", "\[Transpose]"}], ".", "W", ".", "X"}], ",", 
      RowBox[{
       RowBox[{"X", "\[Transpose]"}], ".", "W", ".", "d"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"betaSE", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"Sqrt", "[", 
      RowBox[{
       RowBox[{"robustCovariances", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Length", "[", "d", "]"}], "+", "1"}], ")"}]}], ",", 
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Length", "[", "d", "]"}], "+", "1"}], ")"}]}]}], "]"}], 
        "]"}], "/", "nObs"}], "]"}], "}"}], "~", "Join", "~", 
    RowBox[{"Sqrt", "[", 
     RowBox[{
      RowBox[{"Diagonal", "[", 
       RowBox[{"Inverse", "[", 
        RowBox[{
         RowBox[{"X", "\[Transpose]"}], ".", "W", ".", "X"}], "]"}], "]"}], 
      "/", "nObs"}], "]"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8434369507460485`*^9, 3.843436967592417*^9}, {
   3.8434370634197245`*^9, 3.8434370987300644`*^9}, {3.8434371753759146`*^9, 
   3.843437178236335*^9}, {3.843437431512949*^9, 3.8434374377967176`*^9}, {
   3.8434911752488127`*^9, 3.8434911817311497`*^9}, {3.843495012321067*^9, 
   3.843495020105313*^9}, {3.8434951012854233`*^9, 3.843495140761204*^9}, {
   3.8434952009106555`*^9, 3.843495364308118*^9}, {3.843495424219787*^9, 
   3.843495446631608*^9}, {3.843499644590537*^9, 3.843499647252673*^9}, {
   3.843499692496628*^9, 3.8434996947990823`*^9}, {3.843499791702317*^9, 
   3.8434998655092115`*^9}, {3.8435000163737307`*^9, 3.843500016564731*^9}, {
   3.843500047346859*^9, 3.843500098263956*^9}, {3.8435001514053936`*^9, 
   3.8435002736848354`*^9}, {3.8435004128109627`*^9, 
   3.8435004707497883`*^9}, {3.843500623724346*^9, 3.843500636362134*^9}, {
   3.843501092020773*^9, 3.843501103939094*^9}, {3.8435062072906675`*^9, 
   3.8435063195748014`*^9}, 3.8435118477932496`*^9, {3.843517412850109*^9, 
   3.843517415349221*^9}},
 CellLabel->"In[59]:=",ExpressionUUID->"f7978ff6-9d96-4295-af92-0a64d5d49e7c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Grid", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\"\<prices\>\"", ",", "\"\<const\>\"", ",", "\"\<sugar\>\"", ",", 
       "\"\<mushy\>\""}], "}"}], ",", "beta", ",", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"\"\<(\>\"", "<>", 
         RowBox[{"ToString", "[", "#", "]"}], "<>", "\"\<)\>\""}], "&"}], ",",
        "betaSE"}], "]"}]}], "}"}], ",", 
   RowBox[{"Alignment", "\[Rule]", "Left"}], ",", 
   RowBox[{"Spacings", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", "1"}], "}"}]}], ",", 
   RowBox[{"Frame", "\[Rule]", "All"}], ",", 
   RowBox[{"ItemStyle", "\[Rule]", "\"\<Text\>\""}], ",", 
   RowBox[{"Background", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "None", "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"LightGray", ",", "None"}], "}"}]}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.8435174845240383`*^9, 3.843517532734742*^9}, {
  3.843517619249236*^9, 3.843517666587372*^9}},
 CellLabel->"In[66]:=",ExpressionUUID->"1d730cc8-2f69-4362-8ae6-73475b23df16"],

Cell[BoxData[
 TagBox[GridBox[{
    {"\<\"prices\"\>", "\<\"const\"\>", "\<\"sugar\"\>", "\<\"mushy\"\>"},
    {
     RowBox[{"-", "28.188544362633422`"}], 
     RowBox[{"-", "3.1829021670123545`"}], "0.10908080495144454`", 
     RowBox[{"-", "0.05403318094898321`"}]},
    {"\<\"(7.912)\"\>", "\<\"(0.234628)\"\>", "\<\"(0.0129535)\"\>", \
"\<\"(0.116134)\"\>"}
   },
   AutoDelete->False,
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxBackground->{"Columns" -> {None}, "Rows" -> {
       GrayLevel[0.85], None}},
   GridBoxFrame->{"Columns" -> {{True}}, "Rows" -> {{True}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}},
   GridBoxItemStyle->{"Columns" -> {{"Text"}}, "Rows" -> {{"Text"}}},
   GridBoxSpacings->{"Columns" -> {{2}}, "Rows" -> {{1}}}],
  "Grid"]], "Output",
 CellChangeTimes->{{3.843500263433801*^9, 3.8435002742702427`*^9}, 
   3.8435004719621773`*^9, 3.843500697116541*^9, {3.8435010945298347`*^9, 
   3.843501104726763*^9}, 3.8435035862547846`*^9, 3.843504049107226*^9, {
   3.8435063061370277`*^9, 3.84350632015695*^9}, 3.843509772432229*^9, 
   3.843509812847672*^9, 3.8435103351280117`*^9, 3.843516493698411*^9, 
   3.843517280693818*^9, {3.84351762311526*^9, 3.843517667350648*^9}, 
   3.8435177577775927`*^9, 3.8435192410073085`*^9, 3.8435229090257735`*^9},
 CellLabel->"Out[66]=",ExpressionUUID->"d95fed21-5e14-487a-b0dd-e3530f59a7b3"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"GMMobjective", "[", 
   RowBox[{
   "sigma1_", ",", "sigma2_", ",", "sigma3_", ",", "sigma4_", ",", "pi1_", 
    ",", "pi2_", ",", "pi3_", ",", "pi4_", ",", "pi5_", ",", "pi6_", ",", 
    "pi7_", ",", "pi8_", ",", "pi9_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "sigma", ",", "pi", ",", "marketOutput", ",", "yVals", ",", "parameters",
       ",", "residuals", ",", "meang", ",", "objective"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"sigma", " ", "=", " ", 
      RowBox[{"DiagonalMatrix", "[", 
       RowBox[{"{", 
        RowBox[{"sigma1", ",", "sigma2", ",", "sigma3", ",", "sigma4"}], 
        "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pi", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"pi1", ",", "0", ",", "pi2", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"pi3", ",", "pi4", ",", "0", ",", "pi5"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"pi6", ",", "0", ",", "pi7", ",", "0"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"pi8", ",", "0", ",", "pi9", ",", "0"}], "}"}]}], "}"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"marketOutput", " ", "=", " ", 
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"getYVals", "[", 
          RowBox[{"#", ",", "sigma", ",", "pi"}], "]"}], "&"}], ",", 
        "uniqueMarkets"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"yVals", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"marketOutput", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1", ",", "All"}], "]"}], "]"}], ",", "1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"parameters", "=", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"Inverse", "[", 
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"Xmat", "\[Transpose]"}], ",", "Zmat", ",", "weightMat", 
           ",", 
           RowBox[{"Zmat", "\[Transpose]"}], ",", "Xmat"}], "]"}], "]"}], ",", 
        RowBox[{"Xmat", "\[Transpose]"}], ",", "Zmat", ",", "weightMat", ",", 
        RowBox[{"Zmat", "\[Transpose]"}], ",", "yVals"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"residuals", "=", 
      RowBox[{"yVals", "-", 
       RowBox[{"Dot", "[", 
        RowBox[{"Xmat", ",", "parameters"}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"meang", " ", "=", " ", 
      RowBox[{"{", 
       RowBox[{"Mean", "[", 
        RowBox[{"residuals", " ", "*", " ", "Zmat"}], "]"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"objective", " ", "=", " ", 
      RowBox[{"Dot", "[", 
       RowBox[{"meang", ",", "weightMat", ",", 
        RowBox[{"meang", "\[Transpose]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "objective"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.8435108697077026`*^9, 3.8435109756646905`*^9}, {
   3.8435110489382796`*^9, 3.8435111497636237`*^9}, {3.8435116588101683`*^9, 
   3.8435116610101705`*^9}, {3.843511696572178*^9, 3.8435118427212276`*^9}, 
   3.843511873943472*^9, 3.843511986673335*^9, {3.843512062861444*^9, 
   3.843512066706105*^9}, {3.843512114507615*^9, 3.843512114685149*^9}, {
   3.843512225430018*^9, 3.843512265488905*^9}, {3.8435123236860495`*^9, 
   3.8435123285594606`*^9}, {3.8435151278881197`*^9, 
   3.8435151560617743`*^9}, {3.8435162363245106`*^9, 3.8435162380239944`*^9}, 
   3.843516312204564*^9, {3.843517335955476*^9, 3.8435173512339654`*^9}, {
   3.8435174768332186`*^9, 3.8435174771143904`*^9}, {3.84351885201865*^9, 
   3.8435188897557807`*^9}, {3.843519150277095*^9, 3.843519154951404*^9}},
 CellLabel->"In[67]:=",ExpressionUUID->"585e434c-1ddc-4b93-9664-b0b12e416029"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vars", "=", 
   RowBox[{"{", 
    RowBox[{
    "sigma1", ",", "sigma2", ",", "sigma3", ",", "sigma4", ",", "pi1", ",", 
     "pi2", ",", "pi3", ",", "pi4", ",", "pi5", ",", "pi6", ",", "pi7", ",", 
     "pi8", ",", "pi9"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"initialGuess", "=", 
   RowBox[{"{", 
    RowBox[{
    "0.3302", ",", "2.4526", ",", "0.0163", ",", "0.2441", ",", "5.4819", ",",
      "0.2037", ",", "15.8935", ",", 
     RowBox[{"-", "1.2"}], ",", "2.6342", ",", 
     RowBox[{"-", "0.2506"}], ",", "0.0511", ",", "1.265", ",", 
     RowBox[{"-", "0.8091"}]}], "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8435106153688374`*^9, 3.843510616543573*^9}, {
  3.843510795632497*^9, 3.843510820045918*^9}, {3.8435123861965003`*^9, 
  3.843512446800331*^9}, {3.843512616747591*^9, 3.8435126382998323`*^9}, {
  3.843514443202322*^9, 3.843514515763239*^9}, {3.8435145641872587`*^9, 
  3.843514583829213*^9}, {3.8435146476440983`*^9, 3.843514652911524*^9}, {
  3.843516225314469*^9, 3.8435162647396064`*^9}},
 CellLabel->"In[68]:=",ExpressionUUID->"e80d3b43-af81-4a59-919d-c5b0dff147a2"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"GMMobjective", "[", 
   RowBox[{"Sequence", "@@", "initialGuess"}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.843516274679863*^9, 3.8435162818387823`*^9}, {
  3.843516335976407*^9, 3.843516337348867*^9}},
 CellLabel->"In[70]:=",ExpressionUUID->"911adece-5659-4511-89f1-67b621bd4686"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"24.8644088`", ",", 
   RowBox[{"{", 
    RowBox[{"{", "0.013011233655181314`", "}"}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.8435163084173803`*^9, 3.8435163342014427`*^9}, 
   3.8435163726512785`*^9, 3.843516528709841*^9, 3.8435173156165752`*^9, 
   3.843517443614414*^9, 3.843517785777681*^9, {3.8435189136725683`*^9, 
   3.8435189174956656`*^9}, 3.8435192768235397`*^9, 3.843522934137738*^9},
 CellLabel->"Out[70]=",ExpressionUUID->"a30fa868-8e0b-42a5-8c0e-ba8724acd922"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FindMinimum", "[", 
   RowBox[{
    RowBox[{"GMMobjective", "[", 
     RowBox[{"Sequence", "@@", "vars"}], "]"}], ",", 
    RowBox[{"Transpose", "[", 
     RowBox[{"{", 
      RowBox[{"vars", ",", "initialGuess"}], "}"}], "]"}]}], "]"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.8435106153688374`*^9, 3.843510616543573*^9}, {
  3.843510795632497*^9, 3.843510820045918*^9}, {3.8435123861965003`*^9, 
  3.843512446800331*^9}, {3.843512616747591*^9, 3.8435126382998323`*^9}, {
  3.843514443202322*^9, 3.843514515763239*^9}, {3.8435145641872587`*^9, 
  3.843514583829213*^9}, {3.8435146476440983`*^9, 3.843514652911524*^9}, {
  3.843516225314469*^9, 3.8435162647396064`*^9}, {3.8435189250208006`*^9, 
  3.84351898672194*^9}},
 CellLabel->"In[71]:=",ExpressionUUID->"3d8656ae-b116-4bf4-8378-910098b531ca"],

Cell[BoxData["\<\"Iteration failed to converge\"\>"], "Print",
 CellChangeTimes->{3.843521590765086*^9, 3.8435390519578347`*^9},
 CellLabel->
  "During evaluation of \
In[71]:=",ExpressionUUID->"77ba3584-9b14-45c7-8b11-5bf6e7accd42"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{{3.8435189375808372`*^9, 3.843518988721484*^9}, 
   3.843521590809086*^9, 3.843539051987838*^9},
 CellLabel->"Out[71]=",ExpressionUUID->"f04f959a-3ccd-4df1-a3e0-b3183cb2e111"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"(", 
   RowBox[{"sol", "=", 
    RowBox[{"IPOPTMinimize", "[", 
     RowBox[{
      RowBox[{"GMMobjective", "[", 
       RowBox[{"Sequence", "@@", "vars"}], "]"}], ",", "vars", ",", 
      "initialGuess"}], "]"}]}], ")"}], "//", 
  "AbsoluteTiming"}], "\[IndentingNewLine]", 
 RowBox[{"IPOPTMinValue", "[", "sol", "]"}], "\[IndentingNewLine]", 
 RowBox[{"IPOPTArgMin", "[", "sol", "]"}]}], "Input",
 CellChangeTimes->{{3.8435106153688374`*^9, 3.843510616543573*^9}, {
  3.843510795632497*^9, 3.843510820045918*^9}, {3.8435123861965003`*^9, 
  3.843512446800331*^9}, {3.843512616747591*^9, 3.8435126382998323`*^9}, {
  3.843514443202322*^9, 3.843514515763239*^9}, {3.8435145641872587`*^9, 
  3.843514583829213*^9}, {3.8435146476440983`*^9, 3.843514652911524*^9}, {
  3.843516225314469*^9, 3.8435162647396064`*^9}, {3.8435189250208006`*^9, 
  3.8435189344860263`*^9}, {3.843518974464836*^9, 3.843519009672547*^9}},
 CellLabel->"In[72]:=",ExpressionUUID->"26a67597-3ac8-4279-94f7-4ece7e67477b"],

Cell[BoxData["\<\"Iteration failed to converge\"\>"], "Print",
 CellChangeTimes->{3.843554524821148*^9},
 CellLabel->
  "During evaluation of \
In[72]:=",ExpressionUUID->"5c7b3b94-68a6-4e4f-a016-3364642b8d30"],

Cell[BoxData["$Aborted"], "Output",
 CellChangeTimes->{
  3.843518941921751*^9, {3.8435189754231997`*^9, 3.8435190103676553`*^9}, 
   3.8435545248506713`*^9},
 CellLabel->"Out[72]=",ExpressionUUID->"d58ee042-5476-46f6-8e3f-712321e07602"],

Cell[BoxData[
 RowBox[{"IPOPTMinValue", "[", "sol", "]"}]], "Output",
 CellChangeTimes->{
  3.843518941921751*^9, {3.8435189754231997`*^9, 3.8435190103676553`*^9}, 
   3.8435545248736324`*^9},
 CellLabel->"Out[73]=",ExpressionUUID->"c7cfb6b8-a697-479c-a974-20353ad003a0"],

Cell[BoxData[
 RowBox[{"IPOPTArgMin", "[", "sol", "]"}]], "Output",
 CellChangeTimes->{
  3.843518941921751*^9, {3.8435189754231997`*^9, 3.8435190103676553`*^9}, 
   3.843554524907342*^9},
 CellLabel->"Out[74]=",ExpressionUUID->"938e7664-a55b-4e85-ad17-21d0eb9c885d"]
}, Open  ]]
},
WindowSize->{1116, 833},
WindowMargins->{{Automatic, 0}, {Automatic, 32}},
TaggingRules->{"TryRealOnly" -> False},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 281, 5, 28, "Input",ExpressionUUID->"01b5a031-f324-463f-a91f-8f1c20b2db72"],
Cell[CellGroupData[{
Cell[864, 29, 248, 4, 28, "Input",ExpressionUUID->"f818eec8-44c0-47ca-9a3b-b95d2307afd2"],
Cell[1115, 35, 345, 4, 32, "Output",ExpressionUUID->"14d03ecb-96a5-4c76-8b97-e1331b42e16d"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1497, 44, 254, 4, 28, "Input",ExpressionUUID->"98aa87ea-4ace-42c9-9a21-bd79434f1326"],
Cell[1754, 50, 1836, 25, 32, "Output",ExpressionUUID->"f707864a-ee69-4fff-976c-8e48b6182948"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3627, 80, 765, 15, 48, "Input",ExpressionUUID->"82f625e1-3e70-4fb3-93c1-57f6b074918c"],
Cell[4395, 97, 1538, 21, 32, "Output",ExpressionUUID->"0fe9a3a5-30fd-4d45-b953-397c80249f88"]
}, Open  ]],
Cell[5948, 121, 379, 8, 28, "Input",ExpressionUUID->"b08353a9-2c5c-428d-bbee-69c211a9eeef"],
Cell[6330, 131, 1389, 35, 86, "Input",ExpressionUUID->"07715fe0-7e58-4bb4-abd1-929fa00e9433"],
Cell[7722, 168, 1302, 31, 48, "Input",ExpressionUUID->"61a7d0c2-239b-4942-92e3-dbf74f25df2a"],
Cell[9027, 201, 2421, 61, 124, "Input",ExpressionUUID->"66453435-852a-46cd-8d9f-d1c0f8d5a9e6"],
Cell[11451, 264, 897, 20, 48, "Input",ExpressionUUID->"d2f933b5-6528-446e-b104-f0d7390d6524"],
Cell[12351, 286, 1417, 31, 48, "Input",ExpressionUUID->"c2fbbae8-fc9b-4506-99bd-7448bce921ff"],
Cell[13771, 319, 2638, 65, 162, "Input",ExpressionUUID->"40f5b28d-e45d-4266-96cd-e6ca5f3b01e6"],
Cell[16412, 386, 1696, 27, 48, "Input",ExpressionUUID->"495b46db-df76-4193-84b4-9dcaaca8e5db"],
Cell[18111, 415, 2025, 46, 181, "Input",ExpressionUUID->"030b796c-7929-4269-84a8-d1064ef36fb5"],
Cell[20139, 463, 7233, 161, 428, "Input",ExpressionUUID->"1e60aaac-47bf-43c8-aa1d-deb82410b124"],
Cell[27375, 626, 4865, 90, 200, "Input",ExpressionUUID->"8d0c1960-48f1-4b94-bad7-be435913df86"],
Cell[32243, 718, 7623, 153, 333, "Input",ExpressionUUID->"e4f601af-98c3-4a2b-acb5-6aeb7a178eba"],
Cell[39869, 873, 764, 11, 28, "Input",ExpressionUUID->"7b7c5488-f6dd-4483-9970-59c154722d41"],
Cell[40636, 886, 3767, 64, 67, "Input",ExpressionUUID->"c708a4b4-f71a-499d-8263-00ffc100d517"],
Cell[44406, 952, 332, 9, 28, "Input",ExpressionUUID->"ae3265cd-6c79-48fb-bc95-5f3ad333849b"],
Cell[44741, 963, 987, 21, 48, "Input",ExpressionUUID->"512641dc-f6f5-4515-8259-cb720382e2df"],
Cell[45731, 986, 883, 17, 48, "Input",ExpressionUUID->"cc8fcd6f-426c-483d-a6da-bbbd9bb21af5"],
Cell[CellGroupData[{
Cell[46639, 1007, 689, 12, 48, "Input",ExpressionUUID->"62aac27a-bb17-49ee-9748-912bf21a1d98"],
Cell[47331, 1021, 1084, 16, 32, "Output",ExpressionUUID->"d29ce53c-5870-472c-a1aa-4655a75881e0"],
Cell[48418, 1039, 1082, 16, 32, "Output",ExpressionUUID->"480d37ed-7336-4413-826e-2c693f899a87"]
}, Open  ]],
Cell[49515, 1058, 375, 8, 28, "Input",ExpressionUUID->"0d870bb7-33d7-43fc-8799-8d2cda37ed08"],
Cell[49893, 1068, 2249, 49, 143, "Input",ExpressionUUID->"f578568c-ff0c-4e3d-b323-a8f320a43cbf"],
Cell[52145, 1119, 3672, 94, 143, "Input",ExpressionUUID->"f7978ff6-9d96-4295-af92-0a64d5d49e7c"],
Cell[CellGroupData[{
Cell[55842, 1217, 1110, 29, 48, "Input",ExpressionUUID->"1d730cc8-2f69-4362-8ae6-73475b23df16"],
Cell[56955, 1248, 1400, 26, 101, "Output",ExpressionUUID->"d95fed21-5e14-487a-b0dd-e3530f59a7b3"]
}, Open  ]],
Cell[58370, 1277, 3773, 84, 219, "Input",ExpressionUUID->"585e434c-1ddc-4b93-9664-b0b12e416029"],
Cell[62146, 1363, 1154, 23, 48, "Input",ExpressionUUID->"e80d3b43-af81-4a59-919d-c5b0dff147a2"],
Cell[CellGroupData[{
Cell[63325, 1390, 344, 7, 28, "Input",ExpressionUUID->"911adece-5659-4511-89f1-67b621bd4686"],
Cell[63672, 1399, 523, 9, 32, "Output",ExpressionUUID->"a30fa868-8e0b-42a5-8c0e-ba8724acd922"]
}, Open  ]],
Cell[CellGroupData[{
Cell[64232, 1413, 855, 17, 28, "Input",ExpressionUUID->"3d8656ae-b116-4bf4-8378-910098b531ca"],
Cell[65090, 1432, 233, 4, 22, "Print",ExpressionUUID->"77ba3584-9b14-45c7-8b11-5bf6e7accd42"],
Cell[65326, 1438, 230, 3, 32, "Output",ExpressionUUID->"f04f959a-3ccd-4df1-a3e0-b3183cb2e111"]
}, Open  ]],
Cell[CellGroupData[{
Cell[65593, 1446, 1027, 19, 67, "Input",ExpressionUUID->"26a67597-3ac8-4279-94f7-4ece7e67477b"],
Cell[66623, 1467, 209, 4, 22, "Print",ExpressionUUID->"5c7b3b94-68a6-4e4f-a016-3364642b8d30"],
Cell[66835, 1473, 237, 4, 32, "Output",ExpressionUUID->"d58ee042-5476-46f6-8e3f-712321e07602"],
Cell[67075, 1479, 271, 5, 32, "Output",ExpressionUUID->"c7cfb6b8-a697-479c-a974-20353ad003a0"],
Cell[67349, 1486, 267, 5, 32, "Output",ExpressionUUID->"938e7664-a55b-4e85-ad17-21d0eb9c885d"]
}, Open  ]]
}
]
*)

